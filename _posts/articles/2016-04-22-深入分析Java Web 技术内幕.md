---
layout: article
title: "深入分析Java Web 技术内幕"
modified:
categories: articles
excerpt: ""
comments: true
tags: []
image: 
  feature: 1600x800.gif.jpg
  teaser: 4002502.jpg
  thumb:
date: 2016-04-22T09:57:29+08:00
---

{% include toc.html %}

{% highlight java %}

{% endhighlight %}

> 这是看这本书的一些读后感，以及一些截图什么的，作者是淘宝的许令波

## 第一章，深入Web请求过程

B/S架构两个方面的好处：

* 客户端使用统一的浏览器。由于浏览器具有统一性，不需要特殊的配置和网络连接有效的屏蔽了不同服务提供商提供给用户使用服务的差异性。另外重要的一点是，浏览器的交互是的用户使用它非常方便，只要使用浏览器就可以

* 服务端使用基于统一的HTTP协议，和传统的C/S框架使用自定义的应用层协议不同，B/S架构都是使用统一的HTTP协议。

### B/S网络架构概述

B/S网络架构从前端到后端都的到了简化，都基于统一的应用层协议HTTP来交互数据，与大多数的传统的**C/S互联网应用程序采用长连接的**交互模式不同，**HTTP协议采用无状态短连接**的通信方式，一次请求就完成了一次数据交互，然后断开连接，采用这种方式能够同时服务更多的用户采用这猴子那个方式是为了能够同时服务更多用户。

基于HTTP协议本身的特点，目前B/S网络架构采用下图的网络架构设计，满足海量用户的访问请求，又要保持用户的快速请求的相应。

![](http://7xqsae.com1.z0.glb.clouddn.com/0.png)


![](http://7xqsae.com1.z0.glb.clouddn.com/1.png)

### 如何发起一个请求

如何发起一个HTTP请求和如何建立一个Socket连接的区别不大，只不过outputStream.write的写的二进制字节数据格式要符合HTTP协议。浏览器在建立Socket连接之前，必须根据地址栏输入的URL域名解析出IP地址，再根据这个IP地址和默认的80端口与远程服务建立Socket连接，然后浏览器根据这个URL组装成一个get类型的HTTP请求头，通过outputStream.write发送到目标服务器,服务器等待inputStream.read返回数据，然后断开这个链接。

发起一个HTTP请求的过程就是建立一个Socket通信的过程。既然发起一个HTTP连接的本质就是建立一个Socket连接，我们就可以模拟浏览器发起HTTP请求，HttpClient就是一个开源通过程序实现的处理HTTP请求处理的工具包。

![](http://7xqsae.com1.z0.glb.clouddn.com/2.png)

### HTTP协议解析

B/S网络架构的核心是HTTP协议，掌握HTTP协议对从事互联网工作的程序员非常重要。要理解HTTP协议，最重要的就是要熟悉HTTP协议中的HTTP Header，HTTP header 控制着互联网成千上万用户的传输，最关键的是，它控制着用户浏览器的渲染的行为和服务器的执行逻辑。

![](http://7xqsae.com1.z0.glb.clouddn.com/3.png)

#### 浏览器的换粗机制

浏览器缓存是一个比较复杂但是又比较重要的机制，我们浏览一个页面时，发现有异常的情况下，通常考虑是不是浏览器做了缓存，然后Ctrl+F5 来再请求一个这个页面，重新请求肯定是最新的页面，为什么重新请求就一定能够请求到没有缓存的页面呢，首先在浏览器端，进行上述操作后，浏览器会直接向目标URL发送请求，而不会使用浏览器缓存的数据，即使再次请求发送到服务端，也有可能访问的是缓存的数据，为了保证能够得到最新的数据，必须通过HTTP协议来控制，当我们使用Ctrl+F5组合刷新一个页面时，在HTTP的请求头中增加一些请求头，告诉服务器需要的是最新的数据而不是缓存。增加的分别是：Pragma:no-cache和Cache-Control：no-cache

![](http://7xqsae.com1.z0.glb.clouddn.com/4.png)

![](http://7xqsae.com1.z0.glb.clouddn.com/5.png)

![](http://7xqsae.com1.z0.glb.clouddn.com/6.png)

### 域名解析

![](http://7xqsae.com1.z0.glb.clouddn.com/7.png)

![](http://7xqsae.com1.z0.glb.clouddn.com/8.png)

![](http://7xqsae.com1.z0.glb.clouddn.com/9.png)

![](http://7xqsae.com1.z0.glb.clouddn.com/10.png)

![](http://7xqsae.com1.z0.glb.clouddn.com/11.png)

域名解析的结果主要缓存在两个地方：一个是Local DNS Server，另一个是本地机器，在windows下可以通过ipconfig/flushdns命令来刷新缓存。

![](http://7xqsae.com1.z0.glb.clouddn.com/12.png)

### CDN  工作机制

![](http://7xqsae.com1.z0.glb.clouddn.com/13.png)

![](http://7xqsae.com1.z0.glb.clouddn.com/14.png)

#### 负载均衡

![](http://7xqsae.com1.z0.glb.clouddn.com/15.png)

![](http://7xqsae.com1.z0.glb.clouddn.com/16.png)

![](http://7xqsae.com1.z0.glb.clouddn.com/17.png)

![](http://7xqsae.com1.z0.glb.clouddn.com/18.png)

## 第二章 深入分析Java I/O的工作机制

可以说大部分Web应用的系统瓶颈都是I/O瓶颈。

### Java的I/O类库的基本架构

Java的I/O操作类在包java.io下，大概有近80个类，可以分为如下的四组：

* 基于字节操作的I/O接口：InputStream和OutputStream

* 基于字符操作的I/O接口：Writer和Reader

* 基于磁盘操作的I/O接口：File

* 基于网络操作的I/O接口：Socket

前两组主要是传输数据的数据格式，后两组主要是传输数据的方式。